---
- name: Deploy VM in AWS
  hosts: all
  vars:
    instance_name: "Ansibledemo"
    ec2_region: "ap-southeast-2"
    aws_key_name: "AnsibleDemoKey"
  tasks:
  
  ################### Delete Private key ###################
    - name: Delete Key Pair {{ aws_key_name  }}
      ec2_key:
        name: "{{ aws_key_name }}"
        region: "{{ ec2_region }}"
        state: absent
      register: remove_key
      ignore_errors: true
      
################### Delete Instances ###################      
    - name: Delete Instances
      ec2_instance:
        region: "{{ ec2_region }}"
        name:  "{{ instance_name }}"
        state: absent
        wait: yes
        wait_timeout: 600
        tags:
          Name: "{{ instance_name }}"
      register: delete_job
